(function(app){var fixTable=function(wind,temp,cityName){var weekday=["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"];$("#weatherTable tbody, thead").empty();$("#weatherTable thead").append("<tr><th>Dag</th><th>Medel-temp</th><th>Max-temp</th><th>Vind kl:12</th></tr>");var d=(new Date).getDay();for(var i=0;i<7;i++){$("#weatherTable tbody").append("<tr><td>"+weekday[d]+"</td><td>"+temp[0][i]+"</td><td>"+temp[1][i]+"</td><td>"+wind[1][i]+"<img id="+i+" src='arrow.png'/></td></tr>");rotateImage(wind[0][i],i);if(d<6){d++}else{d=0}}$("#wrapper").css("height",680)};app.fixTable=fixTable;function rotateImage(rotateValue,number){$("#"+number).rotate({animateTo:rotateValue})}var appendFromStorage=function(){for(var key in localStorage){$("#favorites select").append("<option>"+localStorage.getItem(key)+"</option>")}};app.appendFromStorage=appendFromStorage})(window.app||(window.app={}));(function(app){"use strict";var readLocation=function(Location){var a=$.getJSON("https://maps.googleapis.com/maps/api/geocode/json?address="+Location);a.done(function(result){var latitude=result.results[0].geometry.location.lat.toFixed(3);var longitude=result.results[0].geometry.location.lng.toFixed(3);readSMHI(latitude,longitude)})};app.readLocation=readLocation;function readSMHI(lat,lng){var weatherInfo=[];var b=$.getJSON("http://opendata-download-metfcst.smhi.se/api/category/pmp1.5g/version/1/geopoint/lat/"+lat+"/lon/"+lng+"/data.json");b.done(function(result){$.each(result.timeseries,function(index,val){weatherInfo.push(val)});app.fixTable(app.getWindInfo(weatherInfo),app.getTemp(weatherInfo))})}var readFromCurrentPosition=function(){navigator.geolocation.getCurrentPosition(success,error,options);var options={enableHighAccuracy:true,timeout:5e3,maximumAge:0};function success(pos){var crd=pos.coords;readSMHI(crd.latitude.toFixed(3),crd.longitude.toFixed(3))}function error(err){console.warn("ERROR("+err.code+"): "+err.message)}};app.readFromCurrentPosition=readFromCurrentPosition})(window.app||(window.app={}));(function(app){"use strict";var getWindInfo=function(weatherArray){var windStrenght=[];var windDirection=[];var timeString="12:00:00Z";for(var i=0;i<weatherArray.length;i++){if(weatherArray[i].validTime.indexOf(timeString)!==-1){windDirection.push(weatherArray[i].wd);windStrenght.push(weatherArray[i].ws+" m/s ")}}if(windDirection.length<10){windDirection.splice(0,0,"Ej tillgängligt");windStrenght.splice(0,0,"Ej tillgängligt")}return[windDirection,windStrenght]};app.getWindInfo=getWindInfo;var getTemp=function(weatherArray){var highestTempArray=[];var averageTempArray=[];var b=[];var uniqueDates=[];$.each(weatherArray,function(index,val){var a=weatherArray[index].validTime.split("T");b.push(a[0]);$.each(b,function(i,date){if($.inArray(date,uniqueDates)===-1){uniqueDates.push(date)}})});var a=moment().format("YYYY-MM-DD");if(uniqueDates[0].indexOf(a)==-1){uniqueDates.splice(0,1)}$.each(uniqueDates,function(index,val){var currentDate=uniqueDates[index];var s=0;var n="";var maxArray=[];$.each(weatherArray,function(index,val){if(weatherArray[index].validTime.indexOf(currentDate)!==-1){var number=parseFloat(weatherArray[index].t);s+=number;maxArray.push(number.toFixed(1));n++}else if(index==weatherArray.length-1){var fixed=(s/n).toFixed(1);averageTempArray.push(fixed);getHighestTemp(maxArray,highestTempArray)}})});return[averageTempArray,highestTempArray]};app.getTemp=getTemp;function getHighestTemp(maxArray,highestTempArray){var max=maxArray[0];$.each(maxArray,function(index,val){if(parseFloat(val)>parseFloat(max)){max=val}});highestTempArray.push(max)}})(window.app||(window.app={}));(function(app){"use strict";app.appendFromStorage();app.readFromCurrentPosition();$("#send").click(function(){if($("#City").val()!==""){var location=document.getElementById("City").value;app.readLocation(location)}else if($("#favorites select option:selected").text()!==""){app.readLocation($("#favorites select option:selected").text())}});$("#save").click(function(){var a=$("#City").val();if($("#favorites select").text().indexOf(a)===-1){$("#favorites select").append("<option>"+a+"</option>");localStorage.setItem(a,a)}})})(window.app||(window.app={}));